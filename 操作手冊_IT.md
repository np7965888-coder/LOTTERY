# 抽獎系統操作手冊

## 目錄

1. [系統概述](#系統概述)
2. [Google 試算表設定](#google-試算表設定)
3. [資料建立與更新](#資料建立與更新)
4. [系統功能使用](#系統功能使用)
5. [常見問題](#常見問題)
6. [部署說明](#部署說明)

---

## 系統概述

本抽獎系統是一個完整的企業活動抽獎解決方案，包含以下功能：

- ✅ **報到系統**：員工掃描 QR Code 或手動輸入工號密碼報到
- ✅ **抽獎功能**：支援單筆抽選和批次抽選，自動跳過已中獎者
- ✅ **管理後台**：參與者名單查詢、獎項查詢、中獎紀錄查詢與匯出
- ✅ **視覺特效**：化學式背景動畫、抽獎動畫、彩帶特效
- ✅ **資料儲存**：所有資料自動同步至 Google 試算表

---

## Google 試算表設定

### 步驟 1：建立 Google 試算表

1. 前往 [Google 試算表](https://sheets.google.com)
2. 建立一個新的試算表
3. **重要**：將試算表名稱設定為 `LOTTERY`（必須完全一致，區分大小寫）

### 步驟 2：建立工作表

系統需要以下四個工作表，如果工作表不存在，系統會自動建立。但建議手動建立以確保格式正確：

#### 2.1 participants（參與者名單）

在第一列（標題列）輸入以下欄位：

| 欄位名稱 | 說明 | 範例 | 必填 |
|---------|------|------|------|
| `id` | 員工編號（文字格式，保留前導零） | `001`, `0023` | ✅ |
| `name` | 姓名 | `王小明` | ✅ |
| `department` | 部門 | `研發部` | ✅ |
| `password` | 報到密碼 | `1234` | ✅ |
| `checked_in` | 報到狀態 | `0`（未報到）<br>`1`（已報到）<br>`2`（公差無法到場）<br>`9`（因公未到） | - |
| `won` | 是否中獎 | `FALSE`（未中獎）<br>`TRUE`（已中獎） | - |
| `checked_date` | 報到時間 | ISO 時間格式 | - |
| `notes` | 備註 | 任意文字 | - |

**重要設定**：
- `id` 欄位必須設定為**文字格式**，以保留前導零（如 `001`）
- 設定方法：選取 `id` 欄位 → 格式 → 數字 → 純文字

#### 2.2 prizes（獎項清單）

在第一列（標題列）輸入以下欄位：

| 欄位名稱 | 說明 | 範例 | 必填 |
|---------|------|------|------|
| `prize_id` | 獎項流水碼 | `1`, `2`, `3` | ✅ |
| `prize_title` | 獎項名稱 | `特獎`, `一獎`, `二獎` | ✅ |
| `prize_name` | 獎品名稱 | `現金20萬元`, `iPhone 16 Pro` | ✅ |
| `quantity` | 獎品數量 | `1`（1個）<br>`15`（15個）<br>`0`（無上限） | ✅ |
| `description` | 獎品描述 | `64GB 深空黑色` | - |
| `order` | 抽獎順序 | `1`（最先抽）<br>`2`（第二個抽） | ✅ |
| `mode` | 抽獎模式 | `single`（單筆抽選）<br>`batch`（批次抽選） | ✅ |

**重要說明**：
- `quantity = 0` 表示**無上限抽選**（可無限次抽選）
- `order` 數字越小，越先抽選
- `mode` 決定抽獎方式：
  - `single`：一次只抽一個人，適合大獎
  - `batch`：一次可抽多人，適合小獎

#### 2.3 winners（中獎紀錄）

此工作表由系統自動維護，無需手動建立資料。欄位說明如下：

| 欄位名稱 | 說明 | 範例 |
|---------|------|------|
| `timestamp` | 中獎時間 | ISO 時間格式 |
| `prize_id` | 獎項流水碼 | `1` |
| `prize_title` | 獎項名稱 | `特獎` |
| `prize_name` | 獎品名稱 | `現金20萬元` |
| `participant_id` | 員工編號 | `001` |
| `participant_name` | 中獎者姓名 | `王小明` |
| `admin` | 操作者 | `system` |
| `claimed` | 是否領取 | `FALSE`（未領取）<br>`TRUE`（已領取） |
| `notes` | 備註 | 任意文字 |

#### 2.4 settings（系統設定）

此工作表用於儲存系統設定，欄位如下：

| 欄位名稱 | 說明 | 範例 |
|---------|------|------|
| `key` | 設定鍵 | `checkin_deadline` |
| `value` | 設定值 | ISO 時間格式 |

---

### 步驟 3：設定 Google Apps Script

1. 在試算表中，點選 **擴充功能** → **Apps Script**
2. 將 `gas-code.gs` 檔案中的程式碼全部複製貼上
3. 修改試算表名稱（如果需要）：
   ```javascript
   const SPREADSHEET_NAME = 'LOTTERY'; // 改為您的試算表名稱
   ```
4. 點選 **儲存**（Ctrl+S）**
5. 點選 **部署** → **新增部署作業**
6. 選擇類型：**網頁應用程式**
7. 設定：
   - **執行身份**：我
   - **具有存取權的使用者**：任何人
8. 點選 **部署**
9. **複製部署 URL**（格式類似：`https://script.google.com/macros/s/xxxxx/exec`）
10. 將此 URL 更新到 `src/services/api.js` 中的 `GAS_URL` 變數

---

## 資料建立與更新

### 參與者名單（participants）

#### 方法 1：手動輸入

1. 開啟 `participants` 工作表
2. 從第 2 列開始輸入資料
3. **重要**：確保 `id` 欄位為文字格式（選取欄位 → 格式 → 數字 → 純文字）

**範例資料**：

| id | name | department | password | checked_in | won | checked_date | notes |
|----|------|------------|----------|------------|-----|--------------|-------|
| 001 | 王小明 | 研發部 | 1234 | 0 | FALSE | | |
| 002 | 李小華 | 業務部 | 5678 | 0 | FALSE | | |
| 0023 | 張三 | 管理部 | 9999 | 0 | FALSE | | |

#### 方法 2：CSV 匯入（推薦）

1. 準備 CSV 檔案，格式如下：
   ```csv
   id,name,department,password,checked_in,won,checked_date,notes
   001,王小明,研發部,1234,0,FALSE,,
   002,李小華,業務部,5678,0,FALSE,,
   0023,張三,管理部,9999,0,FALSE,,
   ```

2. 在系統的**管理後台** → **參與者名單** → 點選 **匯入名單**
3. 選擇 CSV 檔案
4. 系統會自動清除舊資料並匯入新資料

**注意事項**：
- CSV 檔案必須包含標題列
- `id` 欄位建議使用引號包住，避免前導零被移除：`"001"`
- `checked_in` 預設為 `0`（未報到）
- `won` 預設為 `FALSE`（未中獎）

#### 方法 3：Excel 匯入

1. 準備 Excel 檔案，格式與 CSV 相同
2. 在管理後台使用 **匯入名單** 功能
3. 系統會自動轉換格式

#### 更新參與者狀態

**手動更新**：
- 直接在試算表中修改 `checked_in` 欄位：
  - `0`：未報到
  - `1`：已報到
  - `2`：公差無法到場（可抽獎，但不會上台領獎）
  - `9`：因公未到（可抽獎，但不會上台領獎）

**透過系統更新**：
- 參與者透過報到頁面報到後，系統會自動更新 `checked_in` 和 `checked_date`

---

### 獎項清單（prizes）

#### 建立獎項

1. 開啟 `prizes` 工作表
2. 從第 2 列開始輸入獎項資料

**範例資料**：

| prize_id | prize_title | prize_name | quantity | description | order | mode |
|----------|-------------|------------|----------|-------------|-------|------|
| 1 | 特獎 | 現金20萬元 | 1 | | 1 | single |
| 2 | 一獎 | iPhone 16 Pro | 2 | 256GB | 2 | single |
| 3 | 二獎 | 現金5000元 | 10 | | 3 | batch |
| 4 | 三獎 | 禮券1000元 | 0 | 無上限 | 4 | batch |

**欄位說明**：

- **prize_id**：唯一識別碼，建議使用流水號（1, 2, 3...）
- **prize_title**：獎項名稱，會顯示在抽獎畫面（如：`特獎`、`一獎`）
- **prize_name**：獎品名稱，會顯示在抽獎畫面（如：`現金20萬元`）
- **quantity**：
  - 數字：該獎項的數量（如 `15` 表示有 15 個）
  - `0`：**無上限**（可無限次抽選）
- **order**：抽獎順序，數字越小越先抽（建議從 1 開始）
- **mode**：
  - `single`：單筆抽選（一次只抽一個人，適合大獎）
  - `batch`：批次抽選（一次可抽多人，適合小獎）

#### 更新獎項

**手動更新**：
- 直接在試算表中修改對應欄位

**透過系統更新**：
- 在管理後台可以查看獎項資訊（目前不支援編輯，需手動在試算表中修改）

---

### 中獎紀錄（winners）

此工作表由系統自動維護，**不建議手動修改**。

如果需要手動調整：
1. 直接在試算表中新增或刪除紀錄
2. 注意 `participant_id` 欄位必須為文字格式
3. `timestamp` 建議使用 ISO 格式（如：`2024-01-15T10:30:00.000Z`）

---

## 系統功能使用

### 報到頁面

**網址**：`https://你的網址.com/checkin`

**使用步驟**：
1. 參與者輸入**員工編號**和**密碼**
2. 點選 **報到** 按鈕
3. 系統會驗證資料並更新報到狀態

**注意事項**：
- 如果已報到過，系統會顯示「您已經報到過了」
- 報到成功後，`checked_in` 會自動更新為 `1`
- 報到時間會記錄在 `checked_date` 欄位

---

### 抽獎頁面

**網址**：`https://你的網址.com/`

**使用步驟**：
1. 系統會自動載入獎項列表（依 `order` 排序）
2. 使用左右箭頭切換獎項
3. 點選 **開始抽獎** 按鈕
4. 觀看抽獎動畫
5. 顯示中獎結果

**抽獎規則**：
- 系統會自動跳過已中獎者（`won = TRUE`）
- 系統會自動跳過未報到者（`checked_in = 0`）
- 單筆抽選（`mode = single`）：一次只抽一個人
- 批次抽選（`mode = batch`）：一次可抽多人（數量由剩餘獎品數決定）

**特殊狀態**：
- `checked_in = 2`（公差無法到場）：可抽獎，但會顯示「⚠️ 不需上台領獎（公差無法到場）」
- `checked_in = 9`（因公未到）：可抽獎，但會顯示「⚠️ 不需上台領獎（因公未到）」

**大獎特殊顯示**：
- 當 `mode = single` 時，中獎者卡片會顯示金色邊框和發光效果，以區別大獎

---

### 管理後台

**網址**：`https://你的網址.com/admin`

#### 參與者名單

**功能**：
- 查看所有參與者資料
- 搜尋參與者（工號、姓名、部門）
- 篩選報到狀態（全部、已報到、未報到、公差無法到場、因公未到）
- 匯入名單（CSV/Excel）
- 重新載入資料

**操作**：
1. 點選 **匯入名單** 按鈕
2. 選擇 CSV 或 Excel 檔案
3. 系統會自動清除舊資料並匯入新資料

#### 獎項清單

**功能**：
- 查看所有獎項資訊
- 顯示獎項名稱、獎品名稱、數量、順序、模式

**注意**：目前不支援在管理後台編輯獎項，需直接在 Google 試算表中修改。

#### 中獎紀錄

**功能**：
- 查看所有中獎紀錄
- 匯出中獎名單（Excel 格式）

**操作**：
1. 點選 **匯出中獎名單** 按鈕
2. 系統會下載 Excel 檔案（檔名：`winners_YYYY-MM-DD.xls`）
3. Excel 檔案包含：時間、獎項、獎品、中獎者、工號、領取狀態

---

## 常見問題

### Q1：試算表名稱必須是 `LOTTERY` 嗎？

**A**：是的，系統預設使用 `LOTTERY` 作為試算表名稱。如果需要使用其他名稱，請修改 `gas-code.gs` 中的 `SPREADSHEET_NAME` 變數。

### Q2：如何保留員工編號的前導零？

**A**：
1. 在試算表中，選取 `id` 欄位（整欄）
2. 點選 **格式** → **數字** → **純文字**
3. 重新輸入員工編號（如：`001`、`0023`）

### Q3：如何設定無上限抽選？

**A**：在 `prizes` 工作表中，將 `quantity` 欄位設為 `0` 即可。

### Q4：抽獎模式（single/batch）如何決定？

**A**：
- `single`：適合大獎（如特獎、一獎），一次只抽一個人，有金色邊框特效
- `batch`：適合小獎（如三獎、四獎），一次可抽多人

### Q5：如何讓某些人不能抽獎？

**A**：將 `checked_in` 設為 `0`（未報到），系統會自動跳過。

### Q6：如何讓某些人可以抽獎但不上台領獎？

**A**：
- `checked_in = 2`：公差無法到場（可抽獎，不上台）
- `checked_in = 9`：因公未到（可抽獎，不上台）

### Q7：如何重抽？

**A**：目前系統不支援在管理後台重抽。如需重抽，請直接在 `winners` 工作表中刪除對應的中獎紀錄，並將 `participants` 工作表中該參與者的 `won` 欄位改為 `FALSE`。

### Q8：如何清除所有報到狀態？

**A**：在 `participants` 工作表中，將所有 `checked_in` 欄位改為 `0`，`checked_date` 欄位清空。

### Q9：如何清除所有中獎紀錄？

**A**：
1. 在 `winners` 工作表中，刪除所有資料列（保留標題列）
2. 在 `participants` 工作表中，將所有 `won` 欄位改為 `FALSE`

### Q10：Google Apps Script 部署後無法使用？

**A**：請檢查：
1. 部署設定：執行身份 = 我，具有存取權的使用者 = 任何人
2. 已授權 Apps Script 存取試算表
3. 試算表名稱是否正確
4. 執行記錄中是否有錯誤（檢視 → 執行記錄）

---

## 部署說明

### 前端部署（Vercel）

#### 步驟 1：準備 Git 儲存庫

1. 初始化 Git（如果尚未初始化）：
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   ```

2. 推送到 GitHub：
   ```bash
   git remote add origin https://github.com/你的帳號/你的儲存庫.git
   git branch -M main
   git push -u origin main
   ```

#### 步驟 2：部署到 Vercel

1. 前往 [Vercel](https://vercel.com)
2. 點選 **New Project**
3. 選擇您的 GitHub 儲存庫
4. 設定：
   - **Framework Preset**：Vite
   - **Root Directory**：`.`（預設）
   - **Build Command**：`npm run build`
   - **Output Directory**：`dist`
5. 點選 **Deploy**
6. 等待部署完成
7. 複製部署網址（如：`https://your-project.vercel.app`）

#### 步驟 3：更新 Google Apps Script URL

1. 確認 Google Apps Script 已正確部署
2. 複製部署 URL
3. 在本地專案中，更新 `src/services/api.js` 中的 `GAS_URL`
4. 重新提交並推送：
   ```bash
   git add src/services/api.js
   git commit -m "Update GAS URL"
   git push
   ```
5. Vercel 會自動重新部署

### 更新部署

每次修改程式碼後：

1. 提交變更：
   ```bash
   git add .
   git commit -m "描述變更內容"
   git push
   ```

2. Vercel 會自動偵測變更並重新部署

### 環境變數（可選）

如果需要使用環境變數管理 Google Apps Script URL：

1. 在 Vercel 專案設定中新增環境變數：
   - 名稱：`VITE_GAS_URL`
   - 值：您的 Google Apps Script URL

2. 在 `src/services/api.js` 中：
   ```javascript
   const GAS_URL = import.meta.env.VITE_GAS_URL || '預設URL';
   ```

---

## 附錄

### 試算表欄位總覽

#### participants（參與者名單）

| 欄位 | 類型 | 必填 | 說明 |
|------|------|------|------|
| id | 文字 | ✅ | 員工編號（保留前導零） |
| name | 文字 | ✅ | 姓名 |
| department | 文字 | ✅ | 部門 |
| password | 文字 | ✅ | 報到密碼 |
| checked_in | 數字 | - | 報到狀態（0/1/2/9） |
| won | 布林 | - | 是否中獎（TRUE/FALSE） |
| checked_date | 文字 | - | 報到時間（ISO 格式） |
| notes | 文字 | - | 備註 |

#### prizes（獎項清單）

| 欄位 | 類型 | 必填 | 說明 |
|------|------|------|------|
| prize_id | 數字 | ✅ | 獎項流水碼 |
| prize_title | 文字 | ✅ | 獎項名稱 |
| prize_name | 文字 | ✅ | 獎品名稱 |
| quantity | 數字 | ✅ | 數量（0=無上限） |
| description | 文字 | - | 獎品描述 |
| order | 數字 | ✅ | 抽獎順序 |
| mode | 文字 | ✅ | 抽獎模式（single/batch） |

#### winners（中獎紀錄）

| 欄位 | 類型 | 必填 | 說明 |
|------|------|------|------|
| timestamp | 文字 | ✅ | 中獎時間（ISO 格式） |
| prize_id | 數字 | ✅ | 獎項流水碼 |
| prize_title | 文字 | ✅ | 獎項名稱 |
| prize_name | 文字 | ✅ | 獎品名稱 |
| participant_id | 文字 | ✅ | 員工編號 |
| participant_name | 文字 | ✅ | 中獎者姓名 |
| admin | 文字 | - | 操作者 |
| claimed | 布林 | - | 是否領取 |
| notes | 文字 | - | 備註 |

---

## 聯絡與支援

如有任何問題，請聯絡系統管理員或參考以下資源：

- Google Apps Script 執行記錄：在 Apps Script 編輯器中，點選 **檢視** → **執行記錄**
- 瀏覽器開發者工具：按 `F12` 開啟，查看 Console 和 Network 標籤
- 系統日誌：在瀏覽器 Console 中查看詳細的 API 呼叫記錄

---

**最後更新**：2024年1月

