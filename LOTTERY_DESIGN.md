# 抽獎系統設計說明

## 設計理念

本抽獎系統採用「**技術與特效分離**」的設計原則，確保抽獎過程的公正性和透明度。

## 核心原則

### 1. ✅ 技術可審核
- 抽獎邏輯與視覺特效完全分離
- 使用 `secureShuffleAndPick` 演算法進行抽獎
- 抽獎結果先確定，再播放特效
- 程式碼開源可審核

### 2. ✅ 視覺效果隨機
- 特效只是視覺呈現，不涉及「從名單挑人」
- 顯示完全隨機的數字跳動
- 不會顯示參與者名單
- 無法從特效判斷抽獎過程

### 3. ✅ 無法質疑公正性
- 不顯示真實參與者名單
- 不存在「滾到某人停止」的過程
- 隨機數字完全無規律
- 最後直接揭曉結果

### 4. ✅ 氣氛緊張刺激
- 3.5秒隨機數字快速跳動
- 彩虹漸變色 + 脈動效果
- 音效配合
- 先顯示工號再顯示姓名（增加懸念）

## 技術實現

### 抽獎流程

```
1. 用戶按下「開始抽獎」按鈕
   ↓
2. 【技術層】執行 secureShuffleAndPick 算法
   - 從合格參與者中隨機抽選
   - 使用加密安全的隨機數生成器
   - 排除已中獎者
   ↓
3. 【視覺層】播放隨機數字動畫
   - 顯示完全隨機的 3-6 位數字
   - 快速跳動 3.5 秒
   - 前 70% 高速，後 30% 減速
   ↓
4. 【結果層】揭曉中獎者
   - 先顯示工號 (0.5秒)
   - 再顯示姓名
   - 播放中獎音效和煙火
```

### 關鍵代碼分離

#### 抽獎邏輯（技術可審核）
```javascript
// 位置：src/components/DrawScreen.jsx - handleSingleDraw
const selected = secureShuffleAndPick(latestParticipants, excludedIds, 1);
const winner = selected[0];
```

#### 視覺特效（純呈現）
```javascript
// 位置：src/components/DrawScreen.jsx - randomNumberAnimation
const generateRandomDisplay = () => {
  const length = Math.floor(Math.random() * 4) + 3; // 3-6位
  let randomNum = '';
  for (let i = 0; i < length; i++) {
    randomNum += Math.floor(Math.random() * 10);
  }
  return randomNum;
};
```

## 視覺效果說明

### 抽獎中畫面

```
┌─────────────────────────────┐
│      第一特獎 - 汽車        │
│                             │
│         8 4 2 7 1           │  ← 隨機數字快速跳動
│                             │     彩虹漸變色
│                             │     脈動放大縮小
│    ⚡ 隨機抽選中...         │
└─────────────────────────────┘
```

### 特效特點

1. **隨機數字**
   - 3-6 位數字（看起來像工號）
   - 每次刷新完全隨機
   - 等寬字體 (monospace)

2. **視覺效果**
   - 彩虹漸變色流動
   - 放大縮小脈動 (1.0 → 1.08)
   - 3D 翻轉效果
   - 發光濾鏡

3. **速度控制**
   - 前 70%：快速跳動（30ms → 15ms）
   - 後 30%：逐漸減速（15ms → 150ms）
   - 總時長：3.5 秒

4. **音效配合**
   - 抽獎中：滾輪音效循環播放
   - 中獎時：中獎音效 + 煙火音效

### 揭曉過程

```
第1階段（隨機數字停止）
    ↓
第2階段（顯示工號 0.5秒）
「82356」
    ↓
第3階段（顯示姓名）
「王小明」
    ↓
煙火特效 + 音效
```

## 公正性保證

### 為什麼無法質疑？

1. **不涉及名單**
   - 特效中看不到任何真實參與者資訊
   - 無法判斷「是否從特定人開始滾」
   - 無法判斷「滾輪速度是否受控」

2. **完全隨機**
   - 顯示的數字與參與者無關
   - 每個數字都是即時生成
   - 無法預測下一個數字

3. **技術分離**
   - 抽獎算法在特效開始前就執行完畢
   - 特效只是視覺呈現，不影響結果
   - 程式碼可以被技術人員審核

4. **結果確定性**
   - 中獎者在動畫開始前就已確定
   - 動畫只是為了增加儀式感
   - 不存在「操控停止位置」的可能

## 與舊版本對比

### 舊版本（名單滾動）

```
優點：
- 參與者可以看到自己的名字出現

缺點：
❌ 可能被質疑「從特定位置開始」
❌ 可能被質疑「控制停止位置」
❌ 涉及「從名單中選人」的視覺感受
❌ 名單順序可能引起爭議
```

### 新版本（隨機數字）

```
優點：
✅ 完全看不出抽獎規律
✅ 無法質疑公正性
✅ 技術與特效完全分離
✅ 氣氛更緊張刺激
✅ 更有儀式感

特點：
- 不顯示參與者名單
- 純隨機數字跳動
- 最後直接揭曉
- 技術可審核
```

## 使用建議

### 現場說明範例

```
主持人：
「我們的抽獎系統採用最新的隨機演算法，
 抽獎結果在按下按鈕的瞬間就已經確定，
 現在看到的數字跳動只是增加現場氣氛，
 完全不會影響抽獎結果。
 讓我們一起見證這個激動人心的時刻！」
```

### 透明度說明

1. **技術審核**
   - 可以讓技術人員審核抽獎算法
   - 程式碼開源在 GitHub
   - 使用業界標準的隨機數生成器

2. **過程記錄**
   - 所有中獎記錄都有時間戳記
   - 抽獎日誌可供查詢
   - 支援匯出中獎名單

3. **公開透明**
   - 抽獎規則事先公告
   - 參與者名單可查詢
   - 中獎記錄即時更新

## 技術細節

### 隨機數生成

```javascript
// 完全隨機，與參與者無關
const generateRandomDisplay = () => {
  const length = Math.floor(Math.random() * 4) + 3; // 3-6位
  let randomNum = '';
  for (let i = 0; i < length; i++) {
    randomNum += Math.floor(Math.random() * 10);
  }
  return randomNum;
};
```

### 抽獎算法

```javascript
// 使用加密安全的隨機數（位於 utils/lottery.js）
import { secureShuffleAndPick } from '../utils/lottery';

// 抽選邏輯
const selected = secureShuffleAndPick(
  latestParticipants,  // 所有參與者
  excludedIds,         // 排除已中獎者
  1                    // 抽選數量
);
```

### 時間軸

```
0ms    - 按下按鈕
1ms    - 執行抽獎算法（確定中獎者）
2ms    - 開始播放視覺特效
3500ms - 特效結束
3500ms - 顯示工號
4000ms - 顯示姓名
4001ms - 播放中獎音效和煙火
```

## 常見問題

### Q1: 數字跳動有規律嗎？
A: 完全沒有。每個數字都是即時隨機生成，與參與者名單無關。

### Q2: 可以控制中獎結果嗎？
A: 不可以。抽獎算法使用加密安全的隨機數生成器，無法預測或控制。

### Q3: 為什麼要顯示隨機數字？
A: 增加現場氣氛和儀式感。同時避免「從名單選人」的視覺感受。

### Q4: 特效會影響抽獎結果嗎？
A: 不會。中獎者在特效開始前就已經確定，特效只是視覺呈現。

### Q5: 如何驗證公正性？
A: 可以審核原始碼中的抽獎算法，查看抽獎日誌和時間戳記。

## 總結

本抽獎系統通過「技術與特效分離」的設計，在保證公正性的同時，提供了緊張刺激的視覺體驗。隨機數字跳動的特效不僅增加了儀式感，更重要的是避免了任何可能引起質疑的視覺元素。

**核心優勢：**
- ✅ 技術可審核
- ✅ 視覺效果隨機
- ✅ 無法質疑公正性
- ✅ 氣氛緊張刺激
- ✅ 抽獎與特效分離

---

**設計版本：** v2.0  
**更新日期：** 2025-01-10  
**設計理念：** 公正、透明、刺激
